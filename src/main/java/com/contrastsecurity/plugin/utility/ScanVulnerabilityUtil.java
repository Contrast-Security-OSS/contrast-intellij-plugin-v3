/*******************************************************************************
 * Copyright Â© 2025 Contrast Security, OSS.
 * See https://www.contrastsecurity.com/enduser-terms for more details.
 *******************************************************************************/

package com.contrastsecurity.plugin.utility;

import com.contrastsecurity.scan.dto.InnerLocation;
import com.contrastsecurity.scan.dto.Vulnerability;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;
import org.apache.commons.lang3.StringUtils;

public class ScanVulnerabilityUtil {

  private ScanVulnerabilityUtil() {}

  public static Map<String, List<Vulnerability>> getMappedVulnerabilities(
      List<Vulnerability> vulnerabilityList) {
    Map<String, List<Vulnerability>> mappedVulnerability =
        vulnerabilityList.stream()
            .filter(vulnerability -> !vulnerability.getLocations().isEmpty())
            .collect(
                Collectors.groupingBy(
                    vulnerability -> {
                      InnerLocation location = vulnerability.getLocations().get(0);
                      if (location.getPhysicalLocation() != null
                          && location.getPhysicalLocation().getArtifactLocation() != null) {
                        return location.getPhysicalLocation().getArtifactLocation().getUri();
                      } else {
                        return StringUtils.EMPTY;
                      }
                    }));
    return mappedVulnerability;
  }
}
